# Конфигурационный язык → YAML конвертер

Инструмент командной строки для преобразования учебного конфигурационного языка в формат YAML с поддержкой синтаксического разбора и обнаружения ошибок.

## Общее описание

Данный проект представляет собой транслятор, который преобразует текст из специального учебного конфигурационного языка в формат YAML. Инструмент разработан на Python с использованием библиотеки `lark` для синтаксического анализа, что обеспечивает строгую проверку синтаксиса и детальные сообщения об ошибках.

### Основные возможности:

- ✅ Разбор конфигурационных файлов с пользовательским синтаксисом
- ✅ Преобразование в стандартный формат YAML
- ✅ Поддержка всех базовых типов данных (числа, строки, массивы, словари)
- ✅ Система констант с вычислением на этапе трансляции
- ✅ Однострочные комментарии
- ✅ Детальные сообщения об ошибках синтаксиса
- ✅ Поддержка вложенных структур любой глубины
- ✅ Полное покрытие тестами

## Синтаксис языка

### Однострочные комментарии

```
; Это однострочный комментарий
; Комментарии игнорируются парсером
```

### Числа

Целые числа со знаком или без:

```
42          ; Положительное число
-15         ; Отрицательное число
0           ; Ноль
+100        ; Явный знак плюс
```

Регулярное выражение: `[+-]?([1-9][0-9]*|0)`

### Строки

Строки заключаются в `@"..."`:

```
@"Это строка"
@"Hello, World!"
@""             ; Пустая строка
```

### Массивы

Массивы обозначаются квадратными скобками, элементы разделяются запятыми:

```
[1, 2, 3, 4, 5]
[@"один", @"два", @"три"]
[1, @"смешанный", -5, [1, 2]]    ; Смешанные типы и вложенность
[]                                ; Пустой массив
```

### Словари

Словари обозначаются фигурными скобками, пары ключ-значение разделяются `=>`:

```
{
  name => @"Иван",
  age => 25,
  city => @"Москва"
}

{}  ; Пустой словарь
```

### Имена (идентификаторы)

Имена состоят только из строчных латинских букв:

```
name
age
config
serverport
```

Регулярное выражение: `[a-z][a-z0-9_]*`

**Примечание**: Имена должны начинаться со строчной латинской буквы, могут содержать цифры и подчеркивания.

### Константы

Объявление константы:

```
let имя = значение
```

Использование константы:

```
.(имя).
```

Пример:

```
let max_users = 100
let default_timeout = 30

{
  users => .(max_users).,
  timeout => .(default_timeout).
}
```

## Описание функций и настроек

### ConfigParser

Основной класс для парсинга конфигурационных файлов.

#### Методы:

- **`parse_file(filepath: str) -> List[Any]`**
  - Читает и парсит конфигурационный файл
  - Параметры:
    - `filepath`: путь к файлу конфигурации
  - Возвращает: список распознанных значений
  - Исключения:
    - `FileNotFoundError`: файл не найден
    - `SyntaxError`: ошибка синтаксиса

- **`parse_string(content: str) -> List[Any]`**
  - Парсит строку с конфигурацией
  - Параметры:
    - `content`: текст конфигурации
  - Возвращает: список распознанных значений
  - Исключения:
    - `SyntaxError`: ошибка синтаксиса

- **`to_yaml(data: List[Any]) -> str`**
  - Преобразует распознанные данные в YAML
  - Параметры:
    - `data`: список данных для преобразования
  - Возвращает: строка в формате YAML

### Параметры командной строки

- **`input_file`** (обязательный)
  - Путь к входному файлу конфигурации
  
- **`-o, --output`** (опциональный)
  - Путь к выходному файлу
  - По умолчанию: вывод в stdout

## Сборка проекта и установка зависимостей

### Требования

- Python 3.7 или выше
- pip (менеджер пакетов Python)

### Установка зависимостей

```powershell
pip install -r requirements.txt
```

Зависимости:
- `lark>=1.1.9` - библиотека для парсинга
- `PyYAML>=6.0.1` - библиотека для работы с YAML
- `pytest>=7.4.0` - фреймворк для тестирования

## Запуск тестов

Проект включает комплексный набор тестов, покрывающих все конструкции языка.

### Запуск всех тестов:

```powershell
pytest test_config_parser.py -v
```

### Запуск с отчетом о покрытии:

```powershell
pytest test_config_parser.py -v --cov=config_lang_parser --cov-report=html
```

### Запуск конкретного класса тестов:

```powershell
pytest test_config_parser.py::TestBasicTypes -v
pytest test_config_parser.py::TestArrays -v
pytest test_config_parser.py::TestConstants -v
```

### Тестовое покрытие

Тесты покрывают:
- ✅ Все базовые типы данных (числа, строки)
- ✅ Массивы (пустые, простые, вложенные)
- ✅ Словари (пустые, простые, вложенные)
- ✅ Константы (объявление, использование, ошибки)
- ✅ Комментарии
- ✅ Сложные вложенные структуры
- ✅ Преобразование в YAML
- ✅ Обработку ошибок

## Примеры использования

### Пример 1: Базовое использование

Файл `simple.conf`:
```
; Простая конфигурация
{
  name => @"Test Server",
  port => 8080,
  enabled => 1
}
```

Команда:
```powershell
python config_lang_parser.py simple.conf
```

Вывод:
```yaml
name: Test Server
port: 8080
enabled: 1
```

### Пример 2: Использование констант

Файл `constants.conf`:
```
let app_name = @"My Application"
let version = 1
let max_connections = 100

{
  application => .(app_name).,
  version => .(version).,
  server => {
    max_connections => .(max_connections).,
    port => 8080
  }
}
```

Команда:
```powershell
python config_lang_parser.py constants.conf
```

### Пример 3: Конфигурация веб-сервера

Файл доступен: `examples/webserver_config.conf`

```powershell
python config_lang_parser.py examples/webserver_config.conf -o webserver.yaml
```

Пример включает:
- Настройки сервера (хост, порт, таймауты)
- Конфигурацию базы данных
- Настройки логирования
- Параметры безопасности
- Административные настройки с порогами оповещений

### Пример 4: Игровой персонаж (RPG)

Файл доступен: `examples/game_character.conf`

```powershell
python config_lang_parser.py examples/game_character.conf -o character.yaml
```

Пример включает:
- Характеристики персонажа
- Систему ресурсов (здоровье, мана)
- Экипировку с эффектами
- Инвентарь с предметами
- Навыки и способности
- Систему квестов

### Пример 5: Университетские курсы

Файл доступен: `examples/university_courses.conf`

```powershell
python config_lang_parser.py examples/university_courses.conf -o courses.yaml
```

Пример включает:
- Информацию о курсах
- Данные преподавателей
- Расписание занятий
- Структуру оценивания
- Учебные материалы
- Предварительные требования

### Пример 6: Вывод в файл

```powershell
python config_lang_parser.py examples/webserver_config.conf -o output.yaml
```

Создаст файл `output.yaml` с результатом преобразования.

### Пример 7: Обработка ошибок

Файл `error.conf`:
```
{
  name => @"Test",
  value => .(undefined).  ; Ошибка: неопределенная константа
}
```

Команда:
```powershell
python config_lang_parser.py error.conf
```

Вывод:
```
Error: Syntax error: Undefined constant: undefined
```

## Структура проекта

```
Конфа/
├── config_lang_parser.py       # Основной модуль парсера
├── test_config_parser.py       # Комплексные тесты
├── requirements.txt            # Зависимости проекта
├── README.md                   # Документация
└── examples/                   # Примеры конфигураций
    ├── webserver_config.conf   # Конфигурация веб-сервера
    ├── game_character.conf     # Игровой персонаж
    └── university_courses.conf # Университетские курсы
```

## Использование как библиотеки

Модуль можно использовать в других Python-проектах:

```python
from config_lang_parser import ConfigParser

# Создать парсер
parser = ConfigParser()

# Распарсить строку
data = parser.parse_string('{name => @"Test", value => 42}')

# Преобразовать в YAML
yaml_output = parser.to_yaml(data)
print(yaml_output)
```

## Коды возврата

- `0` - успешное выполнение
- `1` - файл не найден
- `2` - синтаксическая ошибка
- `3` - другая ошибка

## Ограничения и особенности

1. Имена (идентификаторы) должны начинаться со строчной латинской буквы, могут содержать цифры и подчеркивания: `[a-z][a-z0-9_]*`
2. Числа поддерживаются только целые (int), без дробной части
3. Строки не поддерживают escape-последовательности внутри `@"..."`
4. Константы должны быть объявлены перед использованием
5. Комментарии должны начинаться с символа `;` и занимать всю строку
6. **Важно**: Комментарии могут быть только на уровне statements (между значениями), но не внутри массивов или словарей

## Автор

Проект разработан в рамках курса по конфигурационному управлению.

## Лицензия

Проект создан в учебных целях.
